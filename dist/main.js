!function(n){var e={};function t(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return n[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}t.m=n,t.c=e,t.d=function(n,e,o){t.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:o})},t.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},t.t=function(n,e){if(1&e&&(n=t(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var r in n)t.d(o,r,function(e){return n[e]}.bind(null,r));return o},t.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return t.d(e,"a",e),e},t.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},t.p="",t(t.s=3)}([function(n,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.connection=void 0;var o=i(t(6)),r=i(t(7));function i(n){return n&&n.__esModule?n:{default:n}}o.default.config(),console.log(process.env);var l=r.default.createConnection({host:"hp-education.c7tfzswraxss.eu-central-1.rds.amazonaws.com",user:"sara",password:process.env.DB_PASSWORD,database:"hp-education",multipleStatements:!0});l.connect(),e.connection=l},function(n,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.partnerByPartnerIdLoader=e.sellOutBySchool=e.schoolGroupBySchoolLoader=e.schoolByPartnerLoader=e.partnerBySchoolLoader=e.schoolBySchoolGroupLoader=void 0;var o=l(t(8)),r=t(0),i=l(t(9));function l(n){return n&&n.__esModule?n:{default:n}}e.schoolBySchoolGroupLoader=new o.default(function(n){return new Promise(function(e,t){r.connection.query("\n      SELECT school.*, school_group_school.school_group_id FROM school_group_school\n      JOIN school ON school.id=school_group_school.school_id\n      WHERE school_group_school.school_group_id IN (?);\n    ",[n],function(o,r){if(o)return t(o);e(a(n,"school_group_id",r))})})}),e.partnerBySchoolLoader=new o.default(function(n){return new Promise(function(e,t){r.connection.query("\n      SELECT partner.*, school_partner.school_id FROM school_partner\n      JOIN partner ON partner.id=school_partner.partner_id\n      WHERE school_partner.school_id IN (?);\n    ",[n],function(o,r){if(o)return t(o);e(a(n,"school_id",r))})})}),e.schoolByPartnerLoader=new o.default(function(n){return new Promise(function(e,t){r.connection.query("\n      SELECT school.*, school_partner.partner_id FROM school_partner\n      JOIN school ON school.id=school_partner.school_id\n      WHERE school_partner.partner_id IN (?);\n    ",[n],function(o,r){if(o)return t(o);e(a(n,"partner_id",r))})})}),e.schoolGroupBySchoolLoader=new o.default(function(n){return new Promise(function(e,t){r.connection.query("\n      SELECT school_group.*, school_group_school.school_id FROM school_group_school\n      JOIN school_group ON school_group.id=school_group_school.school_group_id\n      WHERE school_group_school.school_id IN (?);\n    ",[n],function(o,r){if(o)return t(o);e(a(n,"school_id",r))})})}),e.sellOutBySchool=new o.default(function(n){return new Promise(function(e,t){r.connection.query("\n      SELECT * FROM sell_out\n      WHERE sell_out.school_id IN (?);\n    ",[n],function(o,r){if(o)return t(o);e(a(n,"school_id",r))})})}),e.partnerByPartnerIdLoader=new o.default(function(n){return new Promise(function(e,t){r.connection.query("\n      SELECT * FROM partner\n      WHERE id IN (?);\n    ",[n],function(o,r){if(o)return t(o);e(a(n,"id",r))})})});function a(n,e,t){var o=i.default.groupBy(t,e);return n.map(function(n){return o[n]?o[n]:[]})}},function(n,e){n.exports=require("axios")},function(n,e,t){"use strict";var o=t(4),r=t(5),i=t(11),l=c(t(13)),a=c(t(14));function c(n){return n&&n.__esModule?n:{default:n}}global.fetch=a.default;var u=new o.ApolloServer({typeDefs:i.typeDefs,resolvers:r.resolvers,introspection:!0,playground:{settings:{"editor.theme":"light","editor.cursorShape":"line"}}}),s=process.env.PORT||5e3;u.listen({port:s}).then(function(n){var e=n.url;console.log("ðŸš€  "+e),global.client=new l.default({uri:"http://localhost:"+s+"/graphql"})})},function(n,e){n.exports=require("apollo-server")},function(n,e,t){"use strict";var o=t(0),r=t(1),i=l(t(10));l(t(2));function l(n){return n&&n.__esModule?n:{default:n}}function a(n){return"LIMIT "+n.limit+" OFFSET "+n.offset}function c(n){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return n?(n=o.connection.escape("%"+n+"%"),e?"where name like "+n:"where name like "+n+" or  city like "+n+" or  street like "+n):""}var u={school_group:{school:function(n){var e=n.id;return r.schoolBySchoolGroupLoader.load(e)}},school:{school_group:function(n){var e=n.id;return r.schoolGroupBySchoolLoader.load(e)},partners:function(n){var e=n.id;return r.partnerBySchoolLoader.load(e)},sell_out:function(n){var e=n.id;return r.sellOutBySchool.load(e)}},partner:{schools:function(n){var e=n.id;return r.schoolByPartnerLoader.load(e)}},sell_out:{partner:function(n){var e=n.partner_id;return r.partnerByPartnerIdLoader.load(e).then(function(n){return n[0]})}},Query:{school_groups:function(n,e){var t=e.range,r=e.search;return new Promise(function(n,e){o.connection.query("SELECT *, CONCAT(city, ' ', postal_code, ' ', street, ' ', street_number) AS address from school_group "+c(r)+" "+a(t),function(t,o){t&&e(t),n(o)})})},schools:function(n,e){var t=e.range,r=e.search;return new Promise(function(n,e){var i="SELECT *, CONCAT(city, ' ', postal_code, ' ', street, ' ', street_number) AS address from school "+c(r)+" "+a(t);console.log(i),o.connection.query(i,function(t,o){t&&e(t),n(o)})})},school:function(n,e){var t=e.id;return new Promise(function(n,e){o.connection.query("SELECT * from school where id = ?",[t],function(t,o){t&&e(t),n(o[0])})})},partners:function(n,e){var t=e.range,r=e.search;return new Promise(function(n,e){o.connection.query("SELECT * from partner "+c(r,!0)+" order by name "+a(t),function(t,o){t&&e(t),n(o)})})},partner:function(n,e){var t=e.id;return new Promise(function(n,e){o.connection.query("SELECT * from partner where id = ?",[t],function(t,o){t&&e(t),n(o[0])})})}},Mutation:i.default.Mutation};n.exports={resolvers:u}},function(n,e){n.exports=require("dotenv")},function(n,e){n.exports=require("mysql")},function(n,e){n.exports=require("dataloader")},function(n,e){n.exports=require("lodash")},function(n,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o,r=t(0),i=t(1),l=t(2),a=(o=l)&&o.__esModule?o:{default:o};function c(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}e.default={Mutation:{update_entity:function(n,e){var t=e.keyValue,o=t.key,i=t.value,l=t.type,a=e.entity,c=e.id;return new Promise(function(n,e){"number"===l&&(i=Number(i),isNaN(i))?e("incorrect value/type"):("boolean"===l&&(i="true"===i),r.connection.query("UPDATE "+a+" SET "+o+" = ? WHERE id = ?",[i,c],function(e,t,o){if(e)throw e;n({name:a})}))})},recalculate_location:function(n,e){var t=e.city,o=e.street,i=e.street_number,l=e.postal_code,c=e.id;return new Promise(function(n,e){var u="http://www.mapquestapi.com/geocoding/v1/address?key=7Ar65wx0rpVfx7VmKO01pGTf4AhVZazQ&location="+("BELGIE,"+t+","+l+","+o+"%20"+i);console.log({apiLink:u}),a.default.get(u).then(function(e){if(e.data&&e.data.results[0]&&e.data.results[0].locations[0]){var t=e.data.results[0].locations[0].latLng.lat,o=e.data.results[0].locations[0].latLng.lng;console.log(t,o,c),r.connection.query("UPDATE school SET latitude = ?, longitude = ? WHERE id = ?",[t,o,c],function(e,r,i){if(e)throw e;n({latitude:t,longitude:o})})}}).catch(function(n){e(n)})})},create_entity:function(n,e){var t=e.entity;return new Promise(function(n,e){console.log(t),r.connection.query("INSERT INTO "+t+" SET ?",{name:null},function(t,o,r){t&&e(t),n({id:o.insertId})})})},link_entity:function(n,e){var t=e.base_entity_id,o=e.base_entity_name,l=e.link_entity_id,a=e.link_entity_name,u=e.remove;return new Promise(function(n,e){var s,d=o+"_id",_=a+"_id";u?r.connection.query("DELETE FROM "+o+"_"+a+" where "+d+" = "+t+" and "+_+" = "+l,function(r,c,s){r&&e(r),console.log({base_entity_id:t,base_entity_name:o,link_entity_id:l,link_entity_name:a,remove:u}),i.partnerBySchoolLoader.clear(t),n({name:"test"})}):r.connection.query("INSERT INTO "+o+"_"+a+" SET ?",(c(s={},d,t),c(s,_,l),s),function(r,c,s){r&&e(r),console.log({base_entity_id:t,base_entity_name:o,link_entity_id:l,link_entity_name:a,remove:u}),i.partnerBySchoolLoader.clear(t),n({name:"test"})})})}}}},function(n,e,t){"use strict";var o,r,i=(o=["\n  type school {\n    id: Int\n    name: String\n    city: String\n    street: String\n    street_number: String\n    postal_code: Int\n    address: String\n    count_of_students: Int\n    school_level: String\n    school_type: String\n    installed_base: String\n    bring_your_own_device: Boolean\n    website: String\n    school_group: [school_group]\n    partners: [partner]\n    sell_out: [sell_out]\n    longitude: Float\n    latitude: Float\n  }\n\n  type school_group {\n    id: Int\n    name: String\n    city: String\n    street: String\n    street_number: String\n    postal_code: Int\n    address: String\n    count_of_students: Int\n    school: [school]\n    longitude: Float\n    latitude: Float\n  }\n\n  type partner {\n    id: Int\n    name: String\n    education_focused: Boolean\n    schools: [school]\n  }\n\n  type sell_out {\n    units: Int\n    fiscal_year: Int\n    hp_quarter: Int\n    partner: partner\n  }\n\n  type address_prediction {\n    display_string: String,\n    longitude: Float\n    latitude: Float\n    city: String\n    street: String\n    street_number: String\n    postal_code: Int\n  }\n\n  input range {\n    limit: Int!\n    offset: Int!\n  }\n\n  type Query {\n    school_groups(range: range!, search: String): [school_group]\n    schools(range: range!, search: String): [school]\n    partners(range: range!, search: String): [partner]\n    school(id: Int): school\n    partner(id: Int): partner\n  }\n\n  input keyValue {\n    key: String\n    value: String\n    type: String\n  }\n\n  type entity {\n    name: String\n    id: Int\n  }\n\n  type Mutation {\n    update_entity(keyValue: keyValue, id: Int, entity: String): entity\n    create_entity(entity: String): entity\n    link_entity(base_entity_id: Int, base_entity_name: String, link_entity_id: Int, link_entity_name: String, remove: Boolean): entity\n    recalculate_location(city: String, street: String, street_number: String, postal_code: Int, id: Int): school\n  }\n"],r=["\n  type school {\n    id: Int\n    name: String\n    city: String\n    street: String\n    street_number: String\n    postal_code: Int\n    address: String\n    count_of_students: Int\n    school_level: String\n    school_type: String\n    installed_base: String\n    bring_your_own_device: Boolean\n    website: String\n    school_group: [school_group]\n    partners: [partner]\n    sell_out: [sell_out]\n    longitude: Float\n    latitude: Float\n  }\n\n  type school_group {\n    id: Int\n    name: String\n    city: String\n    street: String\n    street_number: String\n    postal_code: Int\n    address: String\n    count_of_students: Int\n    school: [school]\n    longitude: Float\n    latitude: Float\n  }\n\n  type partner {\n    id: Int\n    name: String\n    education_focused: Boolean\n    schools: [school]\n  }\n\n  type sell_out {\n    units: Int\n    fiscal_year: Int\n    hp_quarter: Int\n    partner: partner\n  }\n\n  type address_prediction {\n    display_string: String,\n    longitude: Float\n    latitude: Float\n    city: String\n    street: String\n    street_number: String\n    postal_code: Int\n  }\n\n  input range {\n    limit: Int!\n    offset: Int!\n  }\n\n  type Query {\n    school_groups(range: range!, search: String): [school_group]\n    schools(range: range!, search: String): [school]\n    partners(range: range!, search: String): [partner]\n    school(id: Int): school\n    partner(id: Int): partner\n  }\n\n  input keyValue {\n    key: String\n    value: String\n    type: String\n  }\n\n  type entity {\n    name: String\n    id: Int\n  }\n\n  type Mutation {\n    update_entity(keyValue: keyValue, id: Int, entity: String): entity\n    create_entity(entity: String): entity\n    link_entity(base_entity_id: Int, base_entity_name: String, link_entity_id: Int, link_entity_name: String, remove: Boolean): entity\n    recalculate_location(city: String, street: String, street_number: String, postal_code: Int, id: Int): school\n  }\n"],Object.freeze(Object.defineProperties(o,{raw:{value:Object.freeze(r)}})));var l=(0,t(12).gql)(i);n.exports={typeDefs:l}},function(n,e){n.exports=require("apollo-server-express")},function(n,e){n.exports=require("apollo-boost")},function(n,e){n.exports=require("node-fetch")}]);